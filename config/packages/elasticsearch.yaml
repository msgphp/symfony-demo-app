# https://www.elastic.co/guide/en/elasticsearch/client/php-api/current/_configuration.html

parameters:
    env(ELASTICSEARCH_HOST): ~

services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            '$index': 'api_projections'

    Elasticsearch\ClientBuilder:
        factory: Elasticsearch\ClientBuilder::create
        shared: false
        calls:
            - [setHosts, [['%env(ELASTICSEARCH_HOST)%']]]
    Elasticsearch\Client:
        factory: ['@Elasticsearch\ClientBuilder', build]

    App\Api\InitializeProjectionTypesCommand:
        arguments:
            '$registries': ['@App\Api\ProjectionTypeRegistry']
    App\Api\SynchronizeProjectionsCommand: ~

    App\Api\ProjectionRepository: ~

    App\Api\ProjectionSynchronization:
        arguments:
            '$providers':
                - ['@MsgPhp\User\Repository\UserRepositoryInterface', findAll]
            '$transformers':
                'App\Entity\User\User': !service { class: App\Api\User\UserDocumentTransformer }

    App\Api\ProjectionTypeRegistry:
        arguments:
            '$mappings':
                App\Api\Resource\User:
                    properties:
                        id: ~
                        email: ~
