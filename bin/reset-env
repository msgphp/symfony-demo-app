#!/usr/bin/env bash

source .env.dist
if [[ -f .env ]] ; then
    source .env
fi
if [[ -f .env.local ]] ; then
    source .env.local
fi

composer install && \
bin/console doctrine:database:drop --force --if-exists && \
bin/console doctrine:database:create && \
bin/console doctrine:schema:update --force && \
bin/console doctrine:fixtures:load -n
[[ $? -ne 0 ]] && echo "Environment setup failed" && exit 1

if [[ ! -z $ELASTICSEARCH_HOST ]] ; then
    bin/console projection:initialize-types --force && \
    bin/console projection:synchronize
    [[ $? -ne 0 ]] && echo "Projection synchronization failed" && exit 1
fi
